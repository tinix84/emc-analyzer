<!DOCTYPE html>
<html>
<head>
    <title>Simple WASM Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container { 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 15px; 
            backdrop-filter: blur(10px);
        }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #45a049; }
        .result { 
            background: rgba(0,0,0,0.2); 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border-left: 4px solid #4CAF50;
        }
        .error { border-left-color: #f44336; }
        pre { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Simple WASM EMC Test</h1>
        <p>Testing WASM functions directly without complex framework</p>
        
        <div>
            <button onclick="testWasmLoad()">1. Load WASM Module</button>
            <button onclick="testGetStandard()">2. Get EMC Standard</button>
            <button onclick="testCalculateLimit()">3. Calculate Limit</button>
            <button onclick="testCompliance()">4. Check Compliance</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script type="module">
        import init, { 
            get_emc_standard, 
            calculate_emc_limit, 
            check_emc_compliance,
            generate_emc_mask 
        } from './wasm/emc_wasm.js';

        let wasmModule = null;

        window.testWasmLoad = async function() {
            try {
                addResult("üîÑ Loading WASM module...", "info");
                wasmModule = await init('./wasm/emc_wasm_bg.wasm');
                addResult("‚úÖ WASM module loaded successfully!", "success");
                console.log("WASM module:", wasmModule);
            } catch (error) {
                addResult(`‚ùå WASM load failed: ${error.message}`, "error");
                console.error("WASM load error:", error);
            }
        };

        window.testGetStandard = async function() {
            if (!wasmModule) {
                addResult("‚ùå Load WASM module first!", "error");
                return;
            }
            
            try {
                addResult("üîÑ Getting EMC standard...", "info");
                const standard = get_emc_standard("CISPR25", "Class3", null);
                addResult(`‚úÖ Standard loaded: ${standard.name}`, "success");
                addResult(`üìä Frequency points: ${standard.f_avg_limit_mask.length}`, "info");
                
                // Show first few points
                const preview = {
                    frequencies: standard.f_avg_limit_mask.slice(0, 3),
                    limits: standard.dbuv_avg_limit_mask.slice(0, 3)
                };
                addResult(`üìã Sample data: ${JSON.stringify(preview, null, 2)}`, "info");
                
                // Store for other tests
                window.testStandard = standard;
            } catch (error) {
                addResult(`‚ùå Get standard failed: ${error.message}`, "error");
                console.error("Get standard error:", error);
            }
        };

        window.testCalculateLimit = async function() {
            if (!window.testStandard) {
                addResult("‚ùå Get EMC standard first!", "error");
                return;
            }
            
            try {
                addResult("üîÑ Calculating limits...", "info");
                const frequency = 1000000; // 1 MHz
                const standardJson = JSON.stringify(window.testStandard);
                const result = calculate_emc_limit(standardJson, frequency);
                
                addResult(`‚úÖ Limits at ${frequency} Hz:`, "success");
                addResult(`   AVG: ${result.dbuv_avg_limit.toFixed(1)} dBŒºV`, "info");
                addResult(`   QP:  ${result.dbuv_qp_limit.toFixed(1)} dBŒºV`, "info");
                addResult(`   PK:  ${result.dbuv_pk_limit.toFixed(1)} dBŒºV`, "info");
            } catch (error) {
                addResult(`‚ùå Calculate limit failed: ${error.message}`, "error");
                console.error("Calculate limit error:", error);
            }
        };

        window.testCompliance = async function() {
            if (!window.testStandard) {
                addResult("‚ùå Get EMC standard first!", "error");
                return;
            }
            
            try {
                addResult("üîÑ Checking compliance...", "info");
                const standardJson = JSON.stringify(window.testStandard);
                const frequencies = new Float64Array([500000, 1000000, 5000000]);
                const amplitudes = new Float64Array([45, 55, 65]);
                
                const results = check_emc_compliance(standardJson, frequencies, amplitudes, "avg");
                
                addResult(`‚úÖ Compliance results:`, "success");
                results.forEach((result, i) => {
                    const status = result.passes ? "‚úÖ PASS" : "‚ùå FAIL";
                    addResult(`   ${(frequencies[i]/1000000).toFixed(1)} MHz: ${amplitudes[i]} dBŒºV vs ${result.limit.toFixed(1)} dBŒºV - ${status}`, "info");
                });
            } catch (error) {
                addResult(`‚ùå Compliance check failed: ${error.message}`, "error");
                console.error("Compliance check error:", error);
            }
        };

        function addResult(message, type = "info") {
            const results = document.getElementById("results");
            const div = document.createElement("div");
            div.className = `result ${type}`;
            div.innerHTML = `<pre>${message}</pre>`;
            results.appendChild(div);
            
            // Auto-scroll to bottom
            div.scrollIntoView({ behavior: 'smooth' });
        }

        // Auto-load WASM on page load
        window.addEventListener('load', () => {
            testWasmLoad();
        });
    </script>
</body>
</html>
